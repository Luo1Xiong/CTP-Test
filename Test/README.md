# CTP交易API登录测试程序

完整的CTP交易API登录测试程序，支持连接、认证、登录、查询结算信息、查询资金账户、查询持仓等功能。

## 功能特性

- 连接CTP交易服务器
- 客户端认证 (支持)
- 用户登录/登出
- 查询投资者结算信息
- 投资者结算确认
- 查询资金账户
- 查询投资者持仓
- 心跳检测
- 错误处理

## 编译

### 方式一：使用编译脚本（推荐）

```bash
cd Billionaire-CTP/Test

# 一键编译并运行
./build.sh -f tcp://180.168.146.187:10130 -b 9999 -u 你的用户名 -p 你的密码

# 或者先编译再运行
./build.sh -b    # 仅编译
./build.sh -r -f tcp://180.168.146.187:10130 -b 9999 -u 你的用户名 -p 你的密码    # 仅运行

# 清理后重新编译
./build.sh -c -f tcp://180.168.146.187:10130 -b 9999 -u 你的用户名 -p 你的密码
```

### 方式二：手动编译

```bash
cd Billionaire-CTP/Test
mkdir build && cd build
cmake ..
make
```

## 使用方法

### 命令行参数

```
./ctp_trader_test [选项]

选项:
  -f <地址>  交易服务器地址 (格式: tcp://ip:port)
  -b <经纪商> 经纪公司代码
  -u <用户名> 用户名
  -p <密码>   密码
  -i <投资者> 投资者代码 (默认与用户名相同)
  -a <AppID>  应用ID (用于认证)
  -c <AuthCode> 认证码
  -h          显示帮助信息
```

### 示例

#### SimNow 7x24测试环境 (电信)

```bash
./ctp_trader_test -f tcp://180.168.146.187:10130 -b 9999 -u 你的用户名 -p 你的密码
```

#### SimNow 7x24测试环境 (移动)

```bash
./ctp_trader_test -f tcp://180.168.146.187:10130 -b 9999 -u 你的用户名 -p 你的密码
```

#### 使用认证码

```bash
./ctp_trader_test -f tcp://交易服务器地址:端口 \
                  -b 经纪公司代码 \
                  -u 用户名 \
                  -p 密码 \
                  -a 应用ID \
                  -c 认证码
```

## SimNow测试环境

SimNow是上期技术提供的7x24小时CTP仿真测试环境。

### 注册地址

http://www.simnow.com.cn/

### 测试环境信息

| 环境 | 交易前置地址 | 行情前置地址 |
|------|-------------|-------------|
| 电信节点1 | tcp://180.168.146.187:10130 | tcp://180.168.146.187:10131 |
| 电信节点2 | tcp://180.168.146.187:10130 | tcp://180.168.146.187:10131 |
| 移动节点1 | tcp://180.168.146.187:10130 | tcp://180.168.146.187:10131 |
| 移动节点2 | tcp://180.168.146.187:10130 | tcp://180.168.146.187:10131 |

### 经纪公司代码

```
9999
```

## 运行输出示例

```
====================================
  CTP交易API登录测试程序
  版本: 1.0.0
====================================
[配置] 连接配置:
  前端地址: tcp://180.168.146.187:10130
  经纪公司: 9999
  用户名:   test1
  投资者:   test1
====================================
[状态] 创建交易API实例...
[状态] 注册交易服务器地址...
[状态] 初始化交易API...
[状态] 等待连接...
[连接] 成功连接到交易服务器
[状态] 开始用户登录...
[请求] 发送登录请求, RequestID: 1
[登录] 收到登录响应, RequestID: 1
[成功] 登录成功!
====================================
登录信息:
  交易日:    20250131
  登录时间:  14:30:00
  经纪公司:  9999
  用户ID:    test1
  ...
====================================
```

## 目录结构

```
Billionaire-CTP/
├── Framework/
│   └── Linux/
│       ├── ThostFtdcTraderApi.h      # 交易API头文件
│       ├── ThostFtdcUserApiDataType.h
│       ├── ThostFtdcUserApiStruct.h
│       └── thosttraderapi_se.so      # 交易API动态库
└── Test/
    ├── main.cpp                       # 测试程序源码
    ├── CMakeLists.txt                 # CMake配置
    ├── build.sh                       # 编译运行脚本
    └── README.md                      # 说明文档
```

## 注意事项

1. 确保系统中安装了C++11兼容的编译器 (GCC 4.8+ 或 Clang 3.3+)
2. 确保安装了CMake 3.10或更高版本
3. 运行时程序需要在包含`thosttraderapi_se.so`的目录或正确设置LD_LIBRARY_PATH
4. SimNow环境数据为虚拟数据，仅供测试使用

## 退出程序

- 按 `Ctrl+C` 可优雅退出程序
- 程序会自动发送登出请求并释放资源

## 错误码

常见错误码及含义：

| 错误码 | 含义 |
|-------|------|
| 0 | 成功 |
| 3 | 未找到该用户 |
| 43 | 客户端认证失败 |
| 203 | 没有持仓数据 |
